{% extends "base.html" %}
{% block content %}
<div class="panel-head">
    <div>
        <h2 class="panel-title">Report Preference</h2>
        <div class="panel-subtitle">Should we build your report based on your goal, or only based on your exam results?
        </div>
    </div>
    <div class="panel-actions">
        <span class="pill"><i class="fa-solid fa-file-lines"></i> Exam Completed</span>
    </div>
</div>

<div class="glass-card p-4 p-md-5">
    <form method="POST" class="row g-3" id="reportModeForm">
        <div class="col-12">
            <div class="d-flex flex-column gap-2">
                <label class="d-flex gap-2 align-items-start">
                    <input class="form-check-input mt-1" type="radio" name="report_mode" value="results" checked>
                    <div>
                        <div class="text-white fw-bold">Generate a report based on exam results only</div>
                        <div class="text-muted small">A report based on your performance data (no goal added).</div>
                    </div>
                </label>
                <label class="d-flex gap-2 align-items-start">
                    <input class="form-check-input mt-1" type="radio" name="report_mode" value="goal">
                    <div>
                        <div class="text-white fw-bold">Generate a report based on my goal</div>
                        <div class="text-muted small">We will use your goal as input so the AI report adapts to it.
                        </div>
                    </div>
                </label>
            </div>
        </div>

        <div class="col-12" id="goalPromptWrap" style="display:none;">
            <label class="form-label fw-bold small text-uppercase text-muted">Your Goal (Prompt)</label>
            <textarea class="form-control" name="goal_prompt" rows="4"
                placeholder="Example: I want to reach A2 in 8 weeks. I can study 30 minutes a day, 5 days a week. Focus on Speaking and Writing."></textarea>
            <div class="text-muted small mt-2">Note: This text is used to guide the report content.</div>
        </div>

        <div class="col-12 d-flex justify-content-end align-items-center flex-wrap gap-2 mt-2">
            <button class="btn btn-primary btn-lg" type="submit">
                <i class="fa-solid fa-wand-magic-sparkles me-2"></i> Generate Report
            </button>
        </div>
    </form>
</div>

<script>
    (function () {
        const form = document.getElementById("reportModeForm");
        const wrap = document.getElementById("goalPromptWrap");
        if (!form || !wrap) return;

        function sync() {
            const picked = form.querySelector('input[name="report_mode"]:checked');
            const isGoal = picked && picked.value === "goal";
            wrap.style.display = isGoal ? "" : "none";
        }

        form.addEventListener("change", (e) => {
            if (e.target && e.target.name === "report_mode") sync();
        });
        sync();
    })();
</script>
{% endblock %}