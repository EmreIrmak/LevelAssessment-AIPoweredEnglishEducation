{% extends "base.html" %}
{% block content %}
<div class="panel-head">
    <div>
        <h2 class="panel-title">Start Level Assessment</h2>
        <div class="panel-subtitle">Get ready for the next phase. This module is timed after you start.</div>
    </div>
    <div class="panel-actions">
        <span class="pill"><i class="fa-solid fa-layer-group"></i> {{ session.current_module.value }}</span>
        {% if time_limit_seconds and time_limit_seconds > 0 %}
        <span class="pill"><i class="fa-regular fa-clock"></i> {{ (time_limit_seconds // 60) }}m {{ (time_limit_seconds
            % 60) }}s</span>
        {% else %}
        <span class="pill"><i class="fa-regular fa-clock"></i> No limit</span>
        {% endif %}
    </div>
</div>

<div class="glass-card p-4 p-md-5">
    <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="text-muted small">Overall progress</div>
            <div class="text-muted small">{{ overall_progress }}%</div>
        </div>
        <div class="progress" style="height:10px;">
            <div class="progress-bar"
                style="width: {{ overall_progress }}%; background: linear-gradient(90deg, var(--primary), var(--accent));">
            </div>
        </div>
        <div class="text-muted small mt-2">Stage {{ module_index + 1 }} / {{ module_total }}</div>
    </div>
    <div class="text-muted mb-4">
        {% if session.current_module.value == 'Reading' %}
        Read the passage carefully and answer the questions.
        {% elif session.current_module.value == 'Writing' %}
        You will be asked to write a short response. Use clear, modern English.
        {% elif session.current_module.value == 'Listening' %}
        Listen to the audio and answer the questions. Headphones are recommended.
        {% elif session.current_module.value == 'Speaking' %}
        Check your microphone. We will record your speech and transcribe it automatically.
        {% else %}
        Answer the questions. Difficulty adapts to your performance.
        {% endif %}
    </div>

    <form method="POST" action="{{ url_for('test.start_module', session_id=session.id) }}">
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="fa-solid fa-play me-2"></i> Start Module
        </button>
    </form>

    <div class="alert alert-info mt-4 mb-0">
        <strong>Note:</strong> Once started, the timer runs. You can navigate within this module before finishing.
    </div>
</div>
{% endblock %}